#!/usr/bin/env perl
# vim: set filetype=perl:

use strict;
use warnings;

use FindBin;

if (!$ENV{IN_CATALYST_LOCAL_LIB}) {
    my $dir;
    if ( -r "$FindBin::Bin/Makefile.PL" ) {
        $dir = '';
    }
    elsif (-r "$FindBin::Bin/../Makefile.PL") {
        $dir = '../';
    }
    else {
        die("Cannot find Makefile.PL");
    }

    # The target directory... this is what local::lib will be anchored to
    my $target = "${dir}local-lib5";
    my @include = "${dir}lib"; # Check for a .pm here as well

    $ENV{IN_CATALYST_LOCAL_LIB} = "${dir}/script/perl";

    m/^\// or $_ = "$FindBin::Bin/$_" for $target, @include;
    push @include, qw{ . }; # Need '.' for CPAN to work(?)

    $ENV{PERL5LIB} = join ':', $target, @include;

    require local::lib;
    local::lib->import( '--self-contained', $target );
}

$^X = $ENV{IN_CATALYST_LOCAL_LIB};

unless ( caller ) {
    if ( @ARGV ) {
        exec @ARGV;
    }
}

1;

